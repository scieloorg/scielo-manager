{% load i18n %}
{% load trans_status %}
{% load static %}

<link href="{% static 'css/prism.css' %}" rel="stylesheet" />
<style type="text/css">
  /* OVERRIDE STYLES OF PRIMSM
  .line-highlight { left: 15px;}
  FIXES STYLES OF PRIMSM */
  code, pre { font-size: 12px; }
  code[class*="language-"],
  pre[class*="language-"]{ -moz-tab-size: 2; -o-tab-size: 2; tab-size: 2;}
  .line-highlight:before, .line-highlight[data-end]:after {
    border-radius: 0;
    left: 0;
    min-height: 20px;
    min-width: 30px;
    padding: 0;
    top: 0;
  }
</style>

{% if not xml_data.can_be_analyzed.0 %}
  {# could not be analyzed #}
  <div class="alert alert-warning">
    <h4><i class="icon-minus-sign"></i> {% trans "The XML could not be analyzed" %}</h4>
    <p>{{ xml_data.can_be_analyzed.1 }}</p>
  </div>
{% elif not xml_data.annotations %}
  {# xml without annotations #}
  <div class="alert alert-success">
    <i class="icon-ok"></i> {% trans "The XML has no errors" %}
  </div>
{% else %}
  {# xml analyzed and with annotations #}
  <div class="alert alert-block alert-error">
    <h4 class="alert-heading">{{ xml_data.validation_errors.results|length }} {% trans "error(s) found while checking this XML" %}:</h4>
  </div>
  {% if xml_data.validation_errors %}
    <table id="validation_errors_table" class="table table-striped table-condensed">
      <thead>
        <tr>
          <th class="span1">{% trans "Level" %}:</th>
          <th>{% trans "Message" %}:</th>
          <th class="span2">{% trans "Line" %}:</th>
          <th class="span2">{% trans "Column" %}:</th>
        </tr>
      </thead>
      <tbody>
        {% for error in xml_data.validation_errors.results %}
          <tr>
            <td><span class="label label-{% trans_status error.level to_label='True' %}">{{ error.level|upper }}</span></td>
            <td><a class="error_message" href="#" data-search-term="{{ error.message }}">{{ error.message }}</a></td>
            <td>{{ error.line|default:"--" }}</td>
            <td>{{ error.column|default:"--" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
  {# XML ANNOTATED #}
  <pre id="code-block"
    class="line-numbers language-markup pre-scrollable"
    {% if xml_data.validation_errors and xml_data.validation_errors.error_lines %}
      data-line='{{ xml_data.validation_errors.error_lines }}'
    {% endif %}
    ><code class="language-markup">{{ xml_data.annotations }}</code></pre>

    <p style="text-align: center">
      <a id="back-to-errors" href="#" class="btn btn-mini btn-primary">
        {% trans "Back to Errors" %}
      </a>
    </p>
{% endif %}
<script type="text/javascript" src="{% static 'js/prism.js' %}"></script>
